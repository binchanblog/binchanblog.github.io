---
layout: post
title: 色変換処理
categories:
  - Coding
tags:
  - RGB
  - HLS
  - YCbCr
published: true
---

## 1. HLSからRGBへ変換

{% highlight js %}
//---------------------------------------------------------------------------
// INPUT  : const SHORT  aHue    = 色相
//          const SHORT  aLum    = 明度
//          const SHORT  aSat    = 彩度
//                SHORT  aRed   = 赤
//                SHORT  aGreen = 緑
//                SHORT  aBlue  = 青
//---------------------------------------------------------------------------
// OUTPUT : NONE
//---------------------------------------------------------------------------
public static void CvtHLStoRGB(Int16 aHue, Int16 aLum, Int16 aSat, ref Int16 aRed, ref Int16 aGreen, ref Int16 aBlue)
{
	float hue = (float)aHue;
	float lum = (float)aLum / 100;
	float sat = (float)aSat / 100;
	HslColor hsl = new HslColor(hue, sat, lum);
	Color color = HslColor.ToRgb(hsl);

	aRed = color.R;
	aGreen = color.G;
	aBlue = color.B;
}
{% endhighlight %}

## 2. RGBからへHLS変換

{% highlight js %}
//---------------------------------------------------------------------------
// INPUT  : const double aRed   = 赤
//          const double aGreen = 緑
//          const double aBlue  = 青
//                SHORT  aHue   = 色相
//                SHORT  aLum   = 明度
//                SHORT  aSat   = 彩度
//---------------------------------------------------------------------------
// OUTPUT : NONE
//---------------------------------------------------------------------------
public static void CvtRGBtoHLS(Int16 aRed, Int16 aGreen, Int16 aBlue, ref Int16 aHue, ref Int16 aLum, ref Int16 aSat)
{
	Color color = Color.FromArgb(aRed, aGreen, aBlue);
	HslColor hsl = HslColor.FromRgb(color);

	aHue = (Int16)hsl.H;
	aLum = (Int16)(hsl.L * 100);
	aSat = (Int16)(hsl.S * 100);
}
{% endhighlight %}

## 3. RGBからへYCbCr変換処理

{% highlight js %}
/// <summary>
/// RGBからへYCbCr変換処理
/// </summary>
/// <param name="aRed">aRed</param>
/// <param name="aGreen">aGreen</param>
/// <param name="aBlue">aBlue</param>
/// <param name="aY">aY</param>
/// <param name="aCb">aCb</param>
/// <param name="aCr">aCr</param>
public static void CvtRGBtoYCbCr(Int16 aRed, Int16 aGreen, Int16 aBlue, ref Int16 aY, ref Int16 aCb, ref Int16 aCr)
{
	// 計算する
	double Y = 0.257 * aRed + 0.504 * aGreen + 0.098 * aBlue + 16;
	double Cb = -0.148 * aRed - 0.291 * aGreen + 0.439 * aBlue + 128;
	double Cr = 0.439 * aRed - 0.368 * aGreen - 0.071 * aBlue + 128;

	aY = (Int16)Math.Round(Y, 0);
	aCb = (Int16)Math.Round(Cb, 0);
	aCr = (Int16)Math.Round(Cr, 0);
}
{% endhighlight %}

## 4. YCbCrからへRGB変換処理

{% highlight js %}
/// <summary>
/// YCbCrからへRGB変換処理
/// </summary>
/// <param name="aY">aY</param>
/// <param name="aCb">aCb</param>
/// <param name="aCr">aCr</param>
/// <param name="aRed">aRed</param>
/// <param name="aGreen">aGreen</param>
/// <param name="aBlue">aBlue</param>
public static void CvtYCbCrtoRGB(Int16 aY, Int16 aCb, Int16 aCr, ref Int16 aRed, ref Int16 aGreen, ref Int16 aBlue)
{
	// 計算する
	double Red = 1.164 * (aY - 16) + 1.596 * (aCr - 128);
	double Green = 1.164 * (aY - 16) - 0.813 * (aCr - 128) - 0.392 * (aCb - 128);
	double Blue = 1.164 * (aY - 16) + 2.017 * (aCb - 128);

	aRed = (Int16)Math.Round(Red, 0);
	aGreen = (Int16)Math.Round(Green, 0);
	aBlue = (Int16)Math.Round(Blue, 0);

	// 値を検証する
	ValidateRGBValue(ref aRed);
	ValidateRGBValue(ref aGreen);
	ValidateRGBValue(ref aBlue);
}

/// <summary>
/// RGB値を検証処理
/// </summary>
/// <param name="aRGBValue">aRGBValue</param>
private static void ValidateRGBValue(ref Int16 aRGBValue)
{
	if (aRGBValue < 0)
	{
		aRGBValue = 0;
	}
	else if (aRGBValue > 255)
	{
		aRGBValue = 255;
	}
	else
	{
		// DO NOTHING
	}
}
{% endhighlight %}